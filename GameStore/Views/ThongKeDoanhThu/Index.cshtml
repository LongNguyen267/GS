@model GameStore.ViewModels.ThongKeDoanhThuViewModel

@{
    ViewData["Title"] = "Thống kê doanh thu";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container py-5">
    <h1>Thống kê doanh thu</h1>
    <hr />

    <form asp-action="Index" method="get" class="mb-4">
        <div class="row g-3 align-items-end">
            <div class="col-md-3">
                <label for="startDate" class="form-label">Ngày bắt đầu</label>
                <input type="date" class="form-control" name="startDate" id="startDate" value="@Model.StartDate.ToString("yyyy-MM-dd")" />
            </div>
            <div class="col-md-3">
                <label for="endDate" class="form-label">Ngày kết thúc</label>
                <input type="date" class="form-control" name="endDate" id="endDate" value="@Model.EndDate.ToString("yyyy-MM-dd")" />
            </div>
            <div class="col-md-auto">
                <button type="submit" class="btn btn-primary">Xem doanh thu</button>
            </div>
        </div>
    </form>

    <div class="card text-white bg-success mb-3">
        <div class="card-header">Tổng doanh thu</div>
        <div class="card-body">
            <h4 class="card-title">@Model.TotalRevenue.ToString("C0", new System.Globalization.CultureInfo("vi-VN"))</h4>
        </div>
    </div>

    <div class="card text-white bg-info mb-3">
        <div class="card-header">Doanh thu từ @Model.StartDate.ToString("dd/MM/yyyy") đến @Model.EndDate.ToString("dd/MM/yyyy")</div>
        <div class="card-body">
            <h4 class="card-title">@Model.RevenueByDate.ToString("C0", new System.Globalization.CultureInfo("vi-VN"))</h4>
        </div>
    </div>

    <div class="card mt-4 p-3">
        <h4>Biểu đồ doanh thu 30 ngày gần nhất</h4>
        <canvas id="dailyRevenueChart" style="max-height: 400px;"></canvas>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Lấy dữ liệu từ ViewModel và chuyển đổi sang JavaScript
            const dailyRevenueData = @Html.Raw(Json.Serialize(Model.DailyRevenueData));
            const labels = Object.keys(dailyRevenueData);
            const data = Object.values(dailyRevenueData);

            const ctx = document.getElementById('dailyRevenueChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Doanh thu',
                        data: data,
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        });
    </script>
}